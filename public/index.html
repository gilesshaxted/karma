<!DOCTYPE html>

<html lang="en">

<head>

Â  Â  <meta charset="UTF-8">

Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">

Â  Â  <title>Karma Bot Dashboard</title>

Â  Â  <!-- Favicon from logo -->

Â  Â  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">

Â  Â  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">

Â  Â  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">

Â  Â  <link rel="manifest" href="/site.webmanifest">

Â  Â  <!-- Google Fonts: Poppins for headings, Inter for body text -->

Â  Â  <link rel="preconnect" href="https://fonts.googleapis.com">

Â  Â  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

Â  Â  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=Poppins:wght@600;700&display=swap" rel="stylesheet">

Â  Â  <!-- Tailwind CSS CDN -->

Â  Â  <script src="https://cdn.tailwindcss.com"></script>

Â  Â  <style>

Â  Â  Â  Â  :root {

Â  Â  Â  Â  Â  Â  --primary-blue: #1C315E; /* Dark blue from logo */

Â  Â  Â  Â  Â  Â  --secondary-blue: #3E64A5; /* Lighter blue from logo */

Â  Â  Â  Â  Â  Â  --accent-gold: #FFC107; /* Gold from logo */

Â  Â  Â  Â  Â  Â  --text-light: #f3f4f6;

Â  Â  Â  Â  }



Â  Â  Â  Â  body {

Â  Â  Â  Â  Â  Â  font-family: 'Inter', sans-serif;

Â  Â  Â  Â  Â  Â  background-color: var(--primary-blue);

Â  Â  Â  Â  Â  Â  color: var(--text-light);

Â  Â  Â  Â  Â  Â  display: flex;

Â  Â  Â  Â  Â  Â  justify-content: center;

Â  Â  Â  Â  Â  Â  align-items: center;

Â  Â  Â  Â  Â  Â  min-height: 100vh;

Â  Â  Â  Â  Â  Â  padding: 2rem 1rem;

Â  Â  Â  Â  }



Â  Â  Â  Â  h1, h2, h3 {

Â  Â  Â  Â  Â  Â  font-family: 'Poppins', sans-serif;

Â  Â  Â  Â  }



Â  Â  Â  Â  .dashboard-container {

Â  Â  Â  Â  Â  Â  background-color: var(--secondary-blue);

Â  Â  Â  Â  Â  Â  border: 2px solid var(--accent-gold);

Â  Â  Â  Â  }



Â  Â  Â  Â  .server-card:hover {

Â  Â  Â  Â  Â  Â  transform: translateY(-5px) scale(1.02);

Â  Â  Â  Â  Â  Â  box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.2), 0 4-6px -2px rgba(0, 0, 0, 0.1);

Â  Â  Â  Â  Â  Â  background-color: #4c71b3;

Â  Â  Â  Â  }

Â  Â  Â  Â Â 

Â  Â  Â  Â  /* Custom scrollbar for server list */

Â  Â  Â  Â  .server-list::-webkit-scrollbar {

Â  Â  Â  Â  Â  Â  width: 8px;

Â  Â  Â  Â  }



Â  Â  Â  Â  .server-list::-webkit-scrollbar-track {

Â  Â  Â  Â  Â  Â  background: rgba(255, 255, 255, 0.1);

Â  Â  Â  Â  Â  Â  border-radius: 10px;

Â  Â  Â  Â  }



Â  Â  Â  Â  .server-list::-webkit-scrollbar-thumb {

Â  Â  Â  Â  Â  Â  background-color: var(--accent-gold);

Â  Â  Â  Â  Â  Â  border-radius: 10px;

Â  Â  Â  Â  Â  Â  border: 2px solid var(--secondary-blue);

Â  Â  Â  Â  }



Â  Â  Â  Â  .tab-button.active {

Â  Â  Â  Â  Â  Â  background-color: var(--secondary-blue);

Â  Â  Â  Â  Â  Â  border-color: var(--accent-gold);

Â  Â  Â  Â  Â  Â  color: var(--accent-gold);

Â  Â  Â  Â  }

Â  Â  Â  Â  .tab-button {

Â  Â  Â  Â  Â  Â  border-bottom-width: 0;

Â  Â  Â  Â  }

Â  Â  Â  Â  .tab-content {

Â  Â  Â  Â  Â  Â  border-top-left-radius: 0;

Â  Â  Â  Â  Â  Â  border-top-right-radius: 0;

Â  Â  Â  Â  }



Â  Â  Â  Â  .emoji-tag {

Â  Â  Â  Â  Â  Â  background-color: var(--accent-gold);

Â  Â  Â  Â  Â  Â  color: var(--primary-blue);

Â  Â  Â  Â  Â  Â  border-radius: 9999px; /* Tailwind's rounded-full */

Â  Â  Â  Â  Â  Â  padding: 0.25rem 0.75rem; /* Tailwind's px-3 py-1 */

Â  Â  Â  Â  Â  Â  font-size: 0.875rem; /* Tailwind's text-sm */

Â  Â  Â  Â  Â  Â  font-weight: 600; /* Tailwind's font-semibold */

Â  Â  Â  Â  Â  Â  cursor: pointer;

Â  Â  Â  Â  Â  Â  transition: all 0.2s;

Â  Â  Â  Â  }

Â  Â  Â  Â  .emoji-tag:hover {

Â  Â  Â  Â  Â  Â  opacity: 0.8;

Â  Â  Â  Â  Â  Â  transform: scale(0.95);

Â  Â  Â  Â  }

Â  Â  </style>

</head>

<body class="bg-primary-blue text-text-light font-inter">



Â  Â  <div id="app" class="w-full max-w-6xl mx-auto flex flex-col items-center">

Â  Â  Â  Â  <!-- Header with Logo and Title -->

Â  Â  Â  Â  <header class="text-center mb-10 w-full">

Â  Â  Â  Â  Â  Â  <img src="Karmav1.png" alt="Karma Bot Logo" class="mx-auto w-32 h-32 rounded-full ring-4 ring-accent-gold mb-4 shadow-lg">

Â  Â  Â  Â  Â  Â  <h1 class="text-4xl font-extrabold text-accent-gold tracking-tight">Karma Bot Dashboard</h1>

Â  Â  Â  Â  Â  Â  <p class="mt-2 text-lg text-gray-300">Manage your server's moderation and karma settings.</p>

Â  Â  Â  Â  </header>



Â  Â  Â  Â  <main id="main-content" class="w-full">

Â  Â  Â  Â  Â  Â  <!-- Initial State / Loading / Error -->

Â  Â  Â  Â  Â  Â  <div id="initial-state" class="bg-secondary-blue p-8 rounded-2xl shadow-xl dashboard-container text-center w-full min-h-[300px] flex flex-col justify-center items-center">

Â  Â  Â  Â  Â  Â  Â  Â  <div id="loading-spinner" class="hidden">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="animate-spin rounded-full h-16 w-16 border-t-4 border-b-4 border-accent-gold"></div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="mt-4 text-xl">Loading...</p>

Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  <div id="error-message" class="hidden text-center text-red-400">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-xl font-bold">An error occurred.</p>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p id="error-text" class="mt-2 text-sm"></p>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="retry-button" class="mt-4 px-6 py-2 bg-accent-gold text-primary-blue rounded-full font-bold shadow-md hover:bg-yellow-400 transition-colors">Retry</button>

Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  <div id="login-section">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h2 class="text-2xl font-bold mb-4">Welcome!</h2>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="mb-6 text-gray-300">Please log in with Discord to manage your servers.</p>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <a href="/api/login" id="login-button" class="inline-block px-8 py-3 bg-accent-gold text-primary-blue font-bold rounded-full shadow-lg transition-transform transform hover:scale-105">Login with Discord</a>

Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  </div>



Â  Â  Â  Â  Â  Â  <!-- Server Selection View (initially hidden) -->

Â  Â  Â  Â  Â  Â  <div id="server-selection-view" class="hidden">

Â  Â  Â  Â  Â  Â  Â  Â  <h2 class="text-3xl font-bold text-center mb-6 text-accent-gold">Select a Server</h2>

Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-center text-gray-300 mb-8">Click on an icon to manage that server's settings.</p>

Â  Â  Â  Â  Â  Â  Â  Â  <div id="server-icons-grid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-6 max-h-[60vh] overflow-y-auto server-list pr-2">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <!-- Server icons will be dynamically inserted here -->

Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  </div>



Â  Â  Â  Â  Â  Â  <!-- Dashboard View (initially hidden) -->

Â  Â  Â  Â  Â  Â  <div id="dashboard-view" class="hidden w-full">

Â  Â  Â  Â  Â  Â  Â  Â  <div class="bg-secondary-blue p-8 rounded-2xl shadow-xl dashboard-container w-full">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex items-center mb-6">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <img id="guild-icon-large" src="" alt="Server Icon" class="w-16 h-16 rounded-full ring-2 ring-accent-gold mr-4">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h2 id="guild-name-display" class="text-3xl font-bold text-accent-gold"></h2>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="back-to-servers" class="ml-auto flex items-center space-x-2 px-4 py-2 bg-gray-600 text-white rounded-full shadow-md hover:bg-gray-700 transition-colors">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-arrow-left"><path d="m12 19-7-7 7-7"/><path d="M19 12H5"/></svg>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span>Back</span>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>



Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3 class="text-2xl font-bold text-gray-200 mb-4 border-b-2 border-accent-gold pb-2">Configuration Settings</h3>



Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <!-- Tabbed Interface -->

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex flex-wrap border-b border-gray-600 mb-6">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="tab-button active px-4 py-2 text-lg font-semibold rounded-t-lg border border-transparent border-gray-600 focus:outline-none bg-secondary-blue border-b-0 hover:bg-gray-700 transition-colors" data-tab="roles">Moderation & Roles</button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="tab-button px-4 py-2 text-lg font-semibold rounded-t-lg border border-transparent border-gray-600 focus:outline-none hover:bg-gray-700 transition-colors" data-tab="logging">Logging Channels</button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="tab-button px-4 py-2 text-lg font-semibold rounded-t-lg border border-transparent border-gray-600 focus:outline-none hover:bg-gray-700 transition-colors" data-tab="fun">Fun & Games</button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>



Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <form id="config-form" class="space-y-6">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <!-- Tab content will be rendered here -->

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="tab-roles" class="tab-content">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <!-- Roles Tab Content -->

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="tab-logging" class="tab-content hidden">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <!-- Logging Channels Tab Content -->

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="tab-fun" class="tab-content hidden">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <!-- Fun & Games Tab Content -->

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <!-- Save Button -->

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex justify-end pt-4 border-t border-gray-600 mt-6">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button type="submit" class="px-8 py-3 bg-accent-gold text-primary-blue font-bold rounded-full shadow-lg transition-transform transform hover:scale-105">Save Settings</button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </form>

Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  </main>

Â  Â  </div>



Â  Â  <!-- JavaScript for dynamic functionality -->

Â  Â  <script>

Â  Â  Â  Â  // Use provided environment variables

Â  Â  Â  Â  const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';

Â  Â  Â  Â  const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};

Â  Â  Â  Â  const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? initialAuthToken : '';



Â  Â  Â  Â  // UI Elements

Â  Â  Â  Â  const initialState = document.getElementById('initial-state');

Â  Â  Â  Â  const loginSection = document.getElementById('login-section');

Â  Â  Â  Â  const loadingSpinner = document.getElementById('loading-spinner');

Â  Â  Â  Â  const errorSection = document.getElementById('error-message');

Â  Â  Â  Â  const errorText = document.getElementById('error-text');

Â  Â  Â  Â  const retryButton = document.getElementById('retry-button');

Â  Â  Â  Â  const serverSelectionView = document.getElementById('server-selection-view');

Â  Â  Â  Â  const serverIconsGrid = document.getElementById('server-icons-grid');

Â  Â  Â  Â  const dashboardView = document.getElementById('dashboard-view');

Â  Â  Â  Â  const backToServersButton = document.getElementById('back-to-servers');

Â  Â  Â  Â  const guildNameDisplay = document.getElementById('guild-name-display');

Â  Â  Â  Â  const guildIconLarge = document.getElementById('guild-icon-large');

Â  Â  Â  Â  const configForm = document.getElementById('config-form');



Â  Â  Â  Â  let discordAccessToken = null;

Â  Â  Â  Â  let selectedGuildId = null;

Â  Â  Â  Â  let cachedGuilds = [];

Â  Â  Â  Â  let selectedEmojis = new Set(); // To track selected emojis as tags



Â  Â  Â  Â  // Function to show/hide sections

Â  Â  Â  Â  function showSection(section) {

Â  Â  Â  Â  Â  Â  initialState.classList.add('hidden');

Â  Â  Â  Â  Â  Â  serverSelectionView.classList.add('hidden');

Â  Â  Â  Â  Â  Â  dashboardView.classList.add('hidden');

Â  Â  Â  Â  Â  Â  section.classList.remove('hidden');

Â  Â  Â  Â  }



Â  Â  Â  Â  // Function to show the loading spinner

Â  Â  Â  Â  function showLoading(message = 'Loading...') {

Â  Â  Â  Â  Â  Â  loginSection.classList.add('hidden');

Â  Â  Â  Â  Â  Â  errorSection.classList.add('hidden');

Â  Â  Â  Â  Â  Â  loadingSpinner.classList.remove('hidden');

Â  Â  Â  Â  Â  Â  loadingSpinner.querySelector('p').textContent = message;

Â  Â  Â  Â  Â  Â  showSection(initialState);

Â  Â  Â  Â  }



Â  Â  Â  Â  // Function to show an error message

Â  Â  Â  Â  function showErrorMessage(message) {

Â  Â  Â  Â  Â  Â  loadingSpinner.classList.add('hidden');

Â  Â  Â  Â  Â  Â  loginSection.classList.add('hidden');

Â  Â  Â  Â  Â  Â  errorSection.classList.remove('hidden');

Â  Â  Â  Â  Â  Â  errorText.textContent = message;

Â  Â  Â  Â  Â  Â  showSection(initialState);

Â  Â  Â  Â  }



Â  Â  Â  Â  // Function to handle the OAuth redirect and get a token

Â  Â  Â  Â  async function handleOAuthCallback() {

Â  Â  Â  Â  Â  Â  const params = new URLSearchParams(window.location.search);

Â  Â  Â  Â  Â  Â  const code = params.get('code');

Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  if (code) {

Â  Â  Â  Â  Â  Â  Â  Â  showLoading('Logging in...');

Â  Â  Â  Â  Â  Â  Â  Â  try {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const response = await fetch('/api/token', {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  method: 'POST',

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  headers: { 'Content-Type': 'application/json' },

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  body: JSON.stringify({ code })

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const data = await response.json();

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (data.access_token) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  discordAccessToken = data.access_token;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Clear the URL to hide the code

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  window.history.replaceState({}, document.title, window.location.pathname);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  fetchGuilds();

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showErrorMessage('Failed to get Discord access token.');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  } catch (error) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.error('OAuth callback error:', error);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showErrorMessage('An error occurred during Discord login.');

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  } else if (!discordAccessToken) {

Â  Â  Â  Â  Â  Â  Â  Â  // If there's no code and no token, show the login button

Â  Â  Â  Â  Â  Â  Â  Â  showSection(initialState);

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  }



Â  Â  Â  Â  // Function to fetch the user's guilds

Â  Â  Â  Â  async function fetchGuilds() {

Â  Â  Â  Â  Â  Â  showLoading('Fetching your servers...');

Â  Â  Â  Â  Â  Â  try {

Â  Â  Â  Â  Â  Â  Â  Â  const response = await fetch('/api/guilds', {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  headers: { 'Authorization': `Bearer ${discordAccessToken}` }

Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  const guilds = await response.json();



Â  Â  Â  Â  Â  Â  Â  Â  if (response.ok) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  cachedGuilds = guilds;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  renderServerSelection(cachedGuilds);

Â  Â  Â  Â  Â  Â  Â  Â  } else {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showErrorMessage(guilds.message || 'Failed to fetch servers.');

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  catch (error) {

Â  Â  Â  Â  Â  Â  Â  Â  console.error('Error fetching guilds:', error);

Â  Â  Â  Â  Â  Â  Â  Â  showErrorMessage('Failed to connect to the bot backend. Please try again.');

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  }



Â  Â  Â  Â  // Function to render the server selection grid

Â  Â  Â  Â  function renderServerSelection(guilds) {

Â  Â  Â  Â  Â  Â  serverIconsGrid.innerHTML = '';

Â  Â  Â  Â  Â  Â  if (guilds.length === 0) {

Â  Â  Â  Â  Â  Â  Â  Â  serverIconsGrid.innerHTML = `<p class="col-span-full text-center text-gray-300">The bot is not in any servers where you have administrator permissions. Please invite it to a server.</p>`;

Â  Â  Â  Â  Â  Â  } else {

Â  Â  Â  Â  Â  Â  Â  Â  guilds.forEach(guild => {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const iconUrl = guild.icon ? `https://cdn.discordapp.com/icons/${guild.id}/${guild.icon}.png` : `https://placehold.co/144x144/1C315E/FFC107?text=${guild.name.charAt(0)}`;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const serverCard = document.createElement('div');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  serverCard.className = 'server-card flex flex-col items-center p-4 rounded-xl cursor-pointer transition-all duration-300 transform bg-secondary-blue shadow-lg border-2 border-transparent hover:border-accent-gold';

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  serverCard.innerHTML = `

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <img src="${iconUrl}" alt="${guild.name} icon" class="w-36 h-36 rounded-full object-cover">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="mt-3 text-lg font-bold text-gray-100 text-center truncate w-full px-1">${guild.name}</p>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  serverCard.addEventListener('click', () => fetchGuildConfig(guild.id, guild.name, iconUrl));

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  serverIconsGrid.appendChild(serverCard);

Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  showSection(serverSelectionView);

Â  Â  Â  Â  }



Â  Â  Â  Â  // Function to fetch a specific guild's configuration

Â  Â  Â  Â  async function fetchGuildConfig(guildId, guildName, iconUrl) {

Â  Â  Â  Â  Â  Â  showLoading(`Loading settings for ${guildName}...`);

Â  Â  Â  Â  Â  Â  selectedGuildId = guildId;



Â  Â  Â  Â  Â  Â  try {

Â  Â  Â  Â  Â  Â  Â  Â  const response = await fetch(`/api/guild-config?guildId=${guildId}`, {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  headers: { 'Authorization': `Bearer ${discordAccessToken}` }

Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  const data = await response.json();



Â  Â  Â  Â  Â  Â  Â  Â  if (response.ok) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  renderDashboard(data.guildData, data.currentConfig, iconUrl);

Â  Â  Â  Â  Â  Â  Â  Â  } else {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showErrorMessage(data.message || 'Failed to load server configuration.');

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  } catch (error) {

Â  Â  Â  Â  Â  Â  Â  Â  console.error('Error fetching guild config:', error);

Â  Â  Â  Â  Â  Â  Â  Â  showErrorMessage('An error occurred while fetching server configuration.');

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  }

Â  Â  Â  Â Â 

Â  Â  Â  Â  // Function to render the emoji tags

Â  Â  Â  Â  function renderEmojiTags() {

Â  Â  Â  Â  Â  Â  const emojiTagsContainer = document.getElementById('selected-emojis-container');

Â  Â  Â  Â  Â  Â  const hiddenInput = document.getElementById('spamEmojis');

Â  Â  Â  Â  Â  Â  emojiTagsContainer.innerHTML = '';

Â  Â  Â  Â  Â  Â  hiddenInput.value = Array.from(selectedEmojis).join(',');



Â  Â  Â  Â  Â  Â  if (selectedEmojis.size === 0) {

Â  Â  Â  Â  Â  Â  Â  Â  emojiTagsContainer.innerHTML = '<span class="text-sm text-gray-400">No emojis selected.</span>';

Â  Â  Â  Â  Â  Â  } else {

Â  Â  Â  Â  Â  Â  Â  Â  selectedEmojis.forEach(emoji => {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const isCustom = emoji.startsWith('<');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const emojiTag = document.createElement('span');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  emojiTag.className = 'emoji-tag flex items-center space-x-1';

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  emojiTag.dataset.emoji = emoji;



Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (isCustom) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const parts = emoji.match(/<a?:(\w+):(\d+)>/);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const animated = parts[0].includes('a:');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const emojiName = parts[1];

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const emojiId = parts[2];

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const imageUrl = `https://cdn.discordapp.com/emojis/${emojiId}.${animated ? 'gif' : 'png'}`;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  emojiTag.innerHTML = `

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <img src="${imageUrl}" alt="${emojiName}" class="w-5 h-5">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="text-sm">x</span>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  emojiTag.innerHTML = `

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span>${emoji}</span>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="text-sm">x</span>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  emojiTag.addEventListener('click', () => {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  selectedEmojis.delete(emoji);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  renderEmojiTags();

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  emojiTagsContainer.appendChild(emojiTag);

Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  }



Â  Â  Â  Â  // Function to render the dashboard view

Â  Â  Â  Â  function renderDashboard(guildData, currentConfig, iconUrl) {

Â  Â  Â  Â  Â  Â  guildNameDisplay.textContent = guildData.name;

Â  Â  Â  Â  Â  Â  guildIconLarge.src = iconUrl;

Â  Â  Â  Â  Â  Â  guildIconLarge.alt = `${guildData.name} icon`;



Â  Â  Â  Â  Â  Â  // Initialize selected emojis from current config

Â  Â  Â  Â  Â  Â  selectedEmojis = new Set();

Â  Â  Â  Â  Â  Â  if (currentConfig.spamEmojis) {

Â  Â  Â  Â  Â  Â  Â  Â  currentConfig.spamEmojis.split(',').forEach(emoji => {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (emoji.trim() !== '') {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  selectedEmojis.add(emoji.trim());

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  const rolesHtml = `

Â  Â  Â  Â  Â  Â  Â  Â  <div class="space-y-4">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h4 class="text-xl font-bold text-gray-300 pt-4 pb-2 border-b border-gray-600">Moderation Roles</h4>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex flex-col sm:flex-row sm:items-center sm:space-x-4">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="modRoleId" class="w-full sm:w-1/3 text-lg font-semibold">Moderator Role</label>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <select id="modRoleId" name="modRoleId" class="mt-1 block w-full sm:w-2/3 p-3 bg-gray-700 border border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-accent-gold focus:border-accent-gold">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="">Select a role...</option>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${guildData.roles.map(role => `<option value="${role.id}" ${currentConfig.modRoleId === role.id ? 'selected' : ''}>${role.name}</option>`).join('')}

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </select>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex flex-col sm:flex-row sm:items-center sm:space-x-4">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="adminRoleId" class="w-full sm:w-1/3 text-lg font-semibold">Admin Role</label>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <select id="adminRoleId" name="adminRoleId" class="mt-1 block w-full sm:w-2/3 p-3 bg-gray-700 border border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-accent-gold focus:border-accent-gold">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="">Select a role...</option>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${guildData.roles.map(role => `<option value="${role.id}" ${currentConfig.adminRoleId === role.id ? 'selected' : ''}>${role.name}</option>`).join('')}

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </select>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex flex-col sm:flex-row sm:items-center sm:space-x-4">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="modPingRoleId" class="w-full sm:w-1/3 text-lg font-semibold">Moderator Ping Role</label>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <select id="modPingRoleId" name="modPingRoleId" class="mt-1 block w-full sm:w-2/3 p-3 bg-gray-700 border border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-accent-gold focus:border-accent-gold">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="">Select a role...</option>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${guildData.roles.map(role => `<option value="${role.id}" ${currentConfig.modPingRoleId === role.id ? 'selected' : ''}>${role.name}</option>`).join('')}

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </select>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>



Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h4 class="text-xl font-bold text-gray-300 pt-6 pb-2 border-b border-gray-600">Automoderation Rules</h4>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="space-y-4">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex flex-col sm:flex-row sm:items-center sm:space-x-4">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="moderationLevel" class="w-full sm:w-1/3 text-lg font-semibold">Moderation Level</label>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <select id="moderationLevel" name="moderationLevel" class="mt-1 block w-full sm:w-2/3 p-3 bg-gray-700 border border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-accent-gold focus:border-accent-gold">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="none" ${currentConfig.moderationLevel === 'none' ? 'selected' : ''}>None</option>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="low" ${currentConfig.moderationLevel === 'low' ? 'selected' : ''}>Low</option>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="medium" ${currentConfig.moderationLevel === 'medium' ? 'selected' : ''}>Medium</option>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="high" ${currentConfig.moderationLevel === 'high' ? 'selected' : ''}>High</option>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </select>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex flex-col sm:flex-row sm:items-center sm:space-x-4">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="blacklistedWords" class="w-full sm:w-1/3 text-lg font-semibold">Blacklisted Words (comma-separated)</label>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input id="blacklistedWords" name="blacklistedWords" type="text" placeholder="e.g., badword, anotherbad" value="${currentConfig.blacklistedWords || ''}" class="mt-1 block w-full sm:w-2/3 p-3 bg-gray-700 border border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-accent-gold focus:border-accent-gold" />

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex flex-col sm:flex-row sm:items-center sm:space-x-4">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="whitelistedWords" class="w-full sm:w-1/3 text-lg font-semibold">Whitelisted Words (comma-separated)</label>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input id="whitelistedWords" name="whitelistedWords" type="text" placeholder="e.g., goodword, safephrase" value="${currentConfig.whitelistedWords || ''}" class="mt-1 block w-full sm:w-2/3 p-3 bg-gray-700 border border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-accent-gold focus:border-accent-gold" />

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex items-center space-x-2">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="checkbox" id="repeatedTextEnabled" name="repeatedTextEnabled" class="form-checkbox h-5 w-5 text-accent-gold rounded" ${currentConfig.repeatedTextEnabled ? 'checked' : ''}>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="repeatedTextEnabled" class="text-lg font-semibold">Enable Repeated Text Detection</label>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex items-center space-x-2">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="checkbox" id="externalLinksEnabled" name="externalLinksEnabled" class="form-checkbox h-5 w-5 text-accent-gold rounded" ${currentConfig.externalLinksEnabled ? 'checked' : ''}>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="externalLinksEnabled" class="text-lg font-semibold">Enable External Links Detection</label>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex items-center space-x-2">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="checkbox" id="discordInviteLinksEnabled" name="discordInviteLinksEnabled" class="form-checkbox h-5 w-5 text-accent-gold rounded" ${currentConfig.discordInviteLinksEnabled ? 'checked' : ''}>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="discordInviteLinksEnabled" class="text-lg font-semibold">Enable Discord Invite Links Detection</label>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex items-center space-x-2">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="checkbox" id="excessiveEmojiEnabled" name="excessiveEmojiEnabled" class="form-checkbox h-5 w-5 text-accent-gold rounded" ${currentConfig.excessiveEmojiEnabled ? 'checked' : ''}>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="excessiveEmojiEnabled" class="text-lg font-semibold">Enable Excessive Emoji Detection</label>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex flex-col sm:flex-row sm:items-center sm:space-x-4 ml-7">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="excessiveEmojiCount" class="w-full sm:w-1/3 text-lg font-semibold">Max Emojis Allowed</label>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input id="excessiveEmojiCount" name="excessiveEmojiCount" type="number" min="1" value="${currentConfig.excessiveEmojiCount || 5}" class="mt-1 block w-full sm:w-2/3 p-3 bg-gray-700 border border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-accent-gold focus:border-accent-gold" />

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex items-center space-x-2">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="checkbox" id="excessiveMentionsEnabled" name="excessiveMentionsEnabled" class="form-checkbox h-5 w-5 text-accent-gold rounded" ${currentConfig.excessiveMentionsEnabled ? 'checked' : ''}>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="excessiveMentionsEnabled" class="text-lg font-semibold">Enable Excessive Mentions Detection</label>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex flex-col sm:flex-row sm:items-center sm:space-x-4 ml-7">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="excessiveMentionsCount" class="w-full sm:w-1/3 text-lg font-semibold">Max Mentions Allowed</label>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input id="excessiveMentionsCount" name="excessiveMentionsCount" type="number" min="1" value="${currentConfig.excessiveMentionsCount || 5}" class="mt-1 block w-full sm:w-2/3 p-3 bg-gray-700 border border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-accent-gold focus:border-accent-gold" />

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex items-center space-x-2">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="checkbox" id="excessiveCapsEnabled" name="excessiveCapsEnabled" class="form-checkbox h-5 w-5 text-accent-gold rounded" ${currentConfig.excessiveCapsEnabled ? 'checked' : ''}>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="excessiveCapsEnabled" class="text-lg font-semibold">Enable Excessive Caps Detection</label>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex flex-col sm:flex-row sm:items-center sm:space-x-4 ml-7">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="excessiveCapsPercentage" class="w-full sm:w-1/3 text-lg font-semibold">Max Caps Percentage Allowed</label>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input id="excessiveCapsPercentage" name="excessiveCapsPercentage" type="number" min="0" max="100" value="${currentConfig.excessiveCapsPercentage || 70}" class="mt-1 block w-full sm:w-2/3 p-3 bg-gray-700 border border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-accent-gold focus:border-accent-gold" />

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex items-center space-x-2">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="checkbox" id="spamDetectionEnabled" name="spamDetectionEnabled" class="form-checkbox h-5 w-5 text-accent-gold rounded" ${currentConfig.spamDetectionEnabled ? 'checked' : ''}>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="spamDetectionEnabled" class="text-lg font-semibold">Enable Spam Detection (Rapid Messages)</label>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex flex-col sm:flex-row sm:items-center sm:space-x-4 ml-7">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="maxMessages" class="w-full sm:w-1/3 text-lg font-semibold">Max Messages in Timeframe</label>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input id="maxMessages" name="maxMessages" type="number" min="1" value="${currentConfig.maxMessages || 5}" class="mt-1 block w-full sm:w-2/3 p-3 bg-gray-700 border border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-accent-gold focus:border-accent-gold" />

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex flex-col sm:flex-row sm:items-center sm:space-x-4 ml-7">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="timeframeSeconds" class="w-full sm:w-1/3 text-lg font-semibold">Timeframe for Spam (seconds)</label>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input id="timeframeSeconds" name="timeframeSeconds" type="number" min="1" value="${currentConfig.timeframeSeconds || 5}" class="mt-1 block w-full sm:w-2/3 p-3 bg-gray-700 border border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-accent-gold focus:border-accent-gold" />

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>



Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h4 class="text-xl font-bold text-gray-300 pt-6 pb-2 border-b border-gray-600">Immunity Settings</h4>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="space-y-4">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex flex-col sm:flex-row sm:items-center sm:space-x-4">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="immuneRoles" class="w-full sm:w-1/3 text-lg font-semibold">Immune Roles</label>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <select id="immuneRoles" name="immuneRoles" multiple class="mt-1 block w-full sm:w-2/3 p-3 bg-gray-700 border border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-accent-gold focus:border-accent-gold h-32">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="">Select roles (Ctrl/Cmd+click to select multiple)</option>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${guildData.roles.map(role => `<option value="${role.id}" ${currentConfig.immuneRoles.split(',').includes(role.id) ? 'selected' : ''}>${role.name}</option>`).join('')}

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </select>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex flex-col sm:flex-row sm:items-center sm:space-x-4">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="immuneChannels" class="w-full sm:w-1/3 text-lg font-semibold">Immune Channels</label>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <select id="immuneChannels" name="immuneChannels" multiple class="mt-1 block w-full sm:w-2/3 p-3 bg-gray-700 border border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-accent-gold focus:border-accent-gold h-32">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="">Select channels (Ctrl/Cmd+click to select multiple)</option>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${guildData.channels.map(channel => `<option value="${channel.id}" ${currentConfig.immuneChannels.split(',').includes(channel.id) ? 'selected' : ''}>#${channel.name}</option>`).join('')}

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </select>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  `;

Â  Â  Â  Â  Â  Â  const loggingHtml = `

Â  Â  Â  Â  Â  Â  Â  Â  <div class="space-y-4">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex flex-col sm:flex-row sm:items-center sm:space-x-4">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="moderationLogChannelId" class="w-full sm:w-1/3 text-lg font-semibold">Moderation Log Channel</label>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <select id="moderationLogChannelId" name="moderationLogChannelId" class="mt-1 block w-full sm:w-2/3 p-3 bg-gray-700 border border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-accent-gold focus:border-accent-gold">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="">Select a channel...</option>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${guildData.channels.map(channel => `<option value="${channel.id}" ${currentConfig.moderationLogChannelId === channel.id ? 'selected' : ''}>#${channel.name}</option>`).join('')}

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </select>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex flex-col sm:flex-row sm:items-center sm:space-x-4">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="messageLogChannelId" class="w-full sm:w-1/3 text-lg font-semibold">Message Log Channel</label>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <select id="messageLogChannelId" name="messageLogChannelId" class="mt-1 block w-full sm:w-2/3 p-3 bg-gray-700 border border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-accent-gold focus:border-accent-gold">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="">Select a channel...</option>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${guildData.channels.map(channel => `<option value="${channel.id}" ${currentConfig.messageLogChannelId === channel.id ? 'selected' : ''}>#${channel.name}</option>`).join('')}

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </select>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex flex-col sm:flex-row sm:items-center sm:space-x-4">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="memberLogChannelId" class="w-full sm:w-1/3 text-lg font-semibold">Member Log Channel</label>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <select id="memberLogChannelId" name="memberLogChannelId" class="mt-1 block w-full sm:w-2/3 p-3 bg-gray-700 border border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-accent-gold focus:border-accent-gold">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="">Select a channel...</option>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${guildData.channels.map(channel => `<option value="${channel.id}" ${currentConfig.memberLogChannelId === channel.id ? 'selected' : ''}>#${channel.name}</option>`).join('')}

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </select>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex flex-col sm:flex-row sm:items-center sm:space-x-4">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="adminLogChannelId" class="w-full sm:w-1/3 text-lg font-semibold">Admin Log Channel</label>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <select id="adminLogChannelId" name="adminLogChannelId" class="mt-1 block w-full sm:w-2/3 p-3 bg-gray-700 border border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-accent-gold focus:border-accent-gold">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="">Select a channel...</option>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${guildData.channels.map(channel => `<option value="${channel.id}" ${currentConfig.adminLogChannelId === channel.id ? 'selected' : ''}>#${channel.name}</option>`).join('')}

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </select>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex flex-col sm:flex-row sm:items-center sm:space-x-4">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="joinLeaveLogChannelId" class="w-full sm:w-1/3 text-lg font-semibold">Join/Leave Log Channel</label>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <select id="joinLeaveLogChannelId" name="joinLeaveLogChannelId" class="mt-1 block w-full sm:w-2/3 p-3 bg-gray-700 border border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-accent-gold focus:border-accent-gold">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="">Select a channel...</option>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${guildData.channels.map(channel => `<option value="${channel.id}" ${currentConfig.joinLeaveLogChannelId === channel.id ? 'selected' : ''}>#${channel.name}</option>`).join('')}

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </select>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex flex-col sm:flex-row sm:items-center sm:space-x-4">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="boostLogChannelId" class="w-full sm:w-1/3 text-lg font-semibold">Boost Log Channel</label>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <select id="boostLogChannelId" name="boostLogChannelId" class="mt-1 block w-full sm:w-2/3 p-3 bg-gray-700 border border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-accent-gold focus:border-accent-gold">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="">Select a channel...</option>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${guildData.channels.map(channel => `<option value="${channel.id}" ${currentConfig.boostLogChannelId === channel.id ? 'selected' : ''}>#${channel.name}</option>`).join('')}

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </select>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex flex-col sm:flex-row sm:items-center sm:space-x-4">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="modAlertChannelId" class="w-full sm:w-1/3 text-lg font-semibold">Moderation Alerts Channel</label>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <select id="modAlertChannelId" name="modAlertChannelId" class="mt-1 block w-full sm:w-2/3 p-3 bg-gray-700 border border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-accent-gold focus:border-accent-gold">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="">Select a channel...</option>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${guildData.channels.map(channel => `<option value="${channel.id}" ${currentConfig.modAlertChannelId === channel.id ? 'selected' : ''}>#${channel.name}</option>`).join('')}

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </select>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  `;

Â  Â  Â  Â  Â  Â  const funHtml = `

Â  Â  Â  Â  Â  Â  Â  Â  <div class="space-y-4">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex flex-col sm:flex-row sm:items-center sm:space-x-4">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="karmaChannelId" class="w-full sm:w-1/3 text-lg font-semibold">Karma Channel</label>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <select id="karmaChannelId" name="karmaChannelId" class="mt-1 block w-full sm:w-2/3 p-3 bg-gray-700 border border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-accent-gold focus:border-accent-gold">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="">Select a channel...</option>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${guildData.channels.map(channel => `<option value="${channel.id}" ${currentConfig.karmaChannelId === channel.id ? 'selected' : ''}>#${channel.name}</option>`).join('')}

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </select>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex flex-col sm:flex-row sm:items-center sm:space-x-4">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="countingChannelId" class="w-full sm:w-1/3 text-lg font-semibold">Counting Channel</label>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <select id="countingChannelId" name="countingChannelId" class="mt-1 block w-full sm:w-2/3 p-3 bg-gray-700 border border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-accent-gold focus:border-accent-gold">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="">Select a channel...</option>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${guildData.channels.map(channel => `<option value="${channel.id}" ${currentConfig.countingChannelId === channel.id ? 'selected' : ''}>#${channel.name}</option>`).join('')}

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </select>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex flex-col sm:flex-row sm:items-center sm:space-x-4">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="spamChannelId" class="w-full sm:w-1/3 text-lg font-semibold">Spam Fun Channel</label>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <select id="spamChannelId" name="spamChannelId" class="mt-1 block w-full sm:w-2/3 p-3 bg-gray-700 border border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-accent-gold focus:border-accent-gold">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="">Select a channel...</option>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${guildData.channels.map(channel => `<option value="${channel.id}" ${currentConfig.spamChannelId === channel.id ? 'selected' : ''}>#${channel.name}</option>`).join('')}

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </select>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex flex-col sm:flex-row sm:items-center sm:space-x-4">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="spamKeywords" class="w-full sm:w-1/3 text-lg font-semibold">Spam Fun GIF Keywords</label>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input id="spamKeywords" name="spamKeywords" type="text" placeholder="e.g., keyword1, keyword2" value="${currentConfig.spamKeywords || ''}" class="mt-1 block w-full sm:w-2/3 p-3 bg-gray-700 border border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-accent-gold focus:border-accent-gold" />

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <!-- UPDATED EMOJI SELECTOR SECTION -->

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="space-y-2">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="block text-lg font-semibold">Spam Fun Emojis</label>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="selected-emojis-container" class="flex flex-wrap gap-2 p-2 bg-gray-700 rounded-lg min-h-[40px] items-center">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <!-- Emojis will be rendered here as tags -->

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="hidden" id="spamEmojis" name="spamEmojis" value="${currentConfig.spamEmojis || ''}">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex flex-wrap gap-2 max-h-56 overflow-y-auto pr-2 bg-gray-700 rounded-lg p-2">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h5 class="font-semibold text-gray-300 w-full mb-2">Default Emojis:</h5>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="default-emojis-list" class="flex flex-wrap gap-2 w-full">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="text-3xl cursor-pointer hover:scale-110 transition-transform" data-emoji-identifier="ğŸ˜‚" title="ğŸ˜‚">ğŸ˜‚</span>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="text-3xl cursor-pointer hover:scale-110 transition-transform" data-emoji-identifier="ğŸ¤£" title="ğŸ¤£">ğŸ¤£</span>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="text-3xl cursor-pointer hover:scale-110 transition-transform" data-emoji-identifier="ğŸ‰" title="ğŸ‰">ğŸ‰</span>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="text-3xl cursor-pointer hover:scale-110 transition-transform" data-emoji-identifier="ğŸ¥³" title="ğŸ¥³">ğŸ¥³</span>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="text-3xl cursor-pointer hover:scale-110 transition-transform" data-emoji-identifier="ğŸŠ" title="ğŸŠ">ğŸŠ</span>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="text-3xl cursor-pointer hover:scale-110 transition-transform" data-emoji-identifier="âœ¨" title="âœ¨">âœ¨</span>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="text-3xl cursor-pointer hover:scale-110 transition-transform" data-emoji-identifier="ğŸˆ" title="ğŸˆ">ğŸˆ</span>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="text-3xl cursor-pointer hover:scale-110 transition-transform" data-emoji-identifier="â¤ï¸" title="â¤ï¸">â¤ï¸</span>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="text-3xl cursor-pointer hover:scale-110 transition-transform" data-emoji-identifier="ğŸ¤©" title="ğŸ¤©">ğŸ¤©</span>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="text-3xl cursor-pointer hover:scale-110 transition-transform" data-emoji-identifier="ğŸ‘" title="ğŸ‘">ğŸ‘</span>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="text-3xl cursor-pointer hover:scale-110 transition-transform" data-emoji-identifier="ğŸ˜Š" title="ğŸ˜Š">ğŸ˜Š</span>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="text-3xl cursor-pointer hover:scale-110 transition-transform" data-emoji-identifier="ğŸ˜‚" title="ğŸ˜‚">ğŸ˜‚</span>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="text-3xl cursor-pointer hover:scale-110 transition-transform" data-emoji-identifier="ğŸ’¯" title="ğŸ’¯">ğŸ’¯</span>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="text-3xl cursor-pointer hover:scale-110 transition-transform" data-emoji-identifier="ğŸ”¥" title="ğŸ”¥">ğŸ”¥</span>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="text-3xl cursor-pointer hover:scale-110 transition-transform" data-emoji-identifier="ğŸ¤£" title="ğŸ¤£">ğŸ¤£</span>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="text-3xl cursor-pointer hover:scale-110 transition-transform" data-emoji-identifier="â­" title="â­">â­</span>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h5 class="font-semibold text-gray-300 w-full mt-4 mb-2">Server Emojis:</h5>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="custom-emojis-list" class="flex flex-wrap gap-2 w-full">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${guildData.emojis.length > 0 ?Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â guildData.emojis.map(emoji => `

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <img src="${emoji.url}" alt="${emoji.name}" title=":${emoji.name}:" data-emoji-identifier="<${emoji.animated ? 'a' : ''}:${emoji.name}:${emoji.id}>" class="w-8 h-8 cursor-pointer hover:scale-110 transition-transform">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â `).join('')Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â : '<p class="text-sm text-gray-400">No custom emojis found in this server.</p>'

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  `;

Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  document.getElementById('tab-roles').innerHTML = rolesHtml;

Â  Â  Â  Â  Â  Â  document.getElementById('tab-logging').innerHTML = loggingHtml;

Â  Â  Â  Â  Â  Â  document.getElementById('tab-fun').innerHTML = funHtml;

Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  showSection(dashboardView);

Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  // Set up tab switching logic

Â  Â  Â  Â  Â  Â  document.querySelectorAll('.tab-button').forEach(button => {

Â  Â  Â  Â  Â  Â  Â  Â  button.addEventListener('click', () => {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.querySelectorAll('.tab-content').forEach(content => content.classList.add('hidden'));

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  button.classList.add('active');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById(`tab-${button.dataset.tab}`).classList.remove('hidden');

Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  // Make sure the first tab is active on load

Â  Â  Â  Â  Â  Â  document.querySelector('.tab-button[data-tab="roles"]').classList.add('active');



Â  Â  Â  Â  Â  Â  // Initial render of emoji tags

Â  Â  Â  Â  Â  Â  renderEmojiTags();

Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  // Add event listener for emoji clicks in the selection list

Â  Â  Â  Â  Â  Â  document.getElementById('tab-fun').addEventListener('click', (e) => {

Â  Â  Â  Â  Â  Â  Â  Â  const target = e.target;

Â  Â  Â  Â  Â  Â  Â  Â  const emojiIdentifier = target.dataset.emojiIdentifier || target.textContent.trim();

Â  Â  Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  if (emojiIdentifier && target.closest('#default-emojis-list, #custom-emojis-list')) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!selectedEmojis.has(emojiIdentifier)) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  selectedEmojis.add(emojiIdentifier);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  renderEmojiTags();

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  }



Â  Â  Â  Â  // Handle saving the form

Â  Â  Â  Â  configForm.addEventListener('submit', async (e) => {

Â  Â  Â  Â  Â  Â  e.preventDefault();

Â  Â  Â  Â  Â  Â  const formElements = e.target.elements;

Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  // Function to get selected values from a multiple select dropdown

Â  Â  Â  Â  Â  Â  const getSelectedValues = (selectElement) => {

Â  Â  Â  Â  Â  Â  Â  Â  return Array.from(selectElement.options)

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .filter(option => option.selected)

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .map(option => option.value)

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .join(',');

Â  Â  Â  Â  Â  Â  };



Â  Â  Â  Â  Â  Â  const newConfig = {

Â  Â  Â  Â  Â  Â  Â  Â  modRoleId: formElements.modRoleId.value || null,

Â  Â  Â  Â  Â  Â  Â  Â  adminRoleId: formElements.adminRoleId.value || null,

Â  Â  Â  Â  Â  Â  Â  Â  modPingRoleId: formElements.modPingRoleId.value || null,

Â  Â  Â  Â  Â  Â  Â  Â  karmaChannelId: formElements.karmaChannelId.value || null,

Â  Â  Â  Â  Â  Â  Â  Â  countingChannelId: formElements.countingChannelId.value || null,

Â  Â  Â  Â  Â  Â  Â  Â  moderationLogChannelId: formElements.moderationLogChannelId.value || null,

Â  Â  Â  Â  Â  Â  Â  Â  messageLogChannelId: formElements.messageLogChannelId.value || null,

Â  Â  Â  Â  Â  Â  Â  Â  memberLogChannelId: formElements.memberLogChannelId.value || null,

Â  Â  Â  Â  Â  Â  Â  Â  adminLogChannelId: formElements.adminLogChannelId.value || null,

Â  Â  Â  Â  Â  Â  Â  Â  joinLeaveLogChannelId: formElements.joinLeaveLogChannelId.value || null,

Â  Â  Â  Â  Â  Â  Â  Â  boostLogChannelId: formElements.boostLogChannelId.value || null,

Â  Â  Â  Â  Â  Â  Â  Â  modAlertChannelId: formElements.modAlertChannelId.value || null,

Â  Â  Â  Â  Â  Â  Â  Â  spamChannelId: formElements.spamChannelId.value || null,

Â  Â  Â  Â  Â  Â  Â  Â  spamKeywords: formElements.spamKeywords.value || null,

Â  Â  Â  Â  Â  Â  Â  Â  spamEmojis: formElements.spamEmojis.value || null,

Â  Â  Â  Â  Â  Â  Â  Â  // Automoderation settings

Â  Â  Â  Â  Â  Â  Â  Â  moderationLevel: formElements.moderationLevel.value,

Â  Â  Â  Â  Â  Â  Â  Â  blacklistedWords: formElements.blacklistedWords.value,

Â  Â  Â  Â  Â  Â  Â  Â  whitelistedWords: formElements.whitelistedWords.value,

Â  Â  Â  Â  Â  Â  Â  Â  spamDetectionEnabled: formElements.spamDetectionEnabled.checked,

Â  Â  Â  Â  Â  Â  Â  Â  maxMessages: parseInt(formElements.maxMessages.value, 10),

Â  Â  Â  Â  Â  Â  Â  Â  timeframeSeconds: parseInt(formElements.timeframeSeconds.value, 10),

Â  Â  Â  Â  Â  Â  Â  Â  repeatedTextEnabled: formElements.repeatedTextEnabled.checked,

Â  Â  Â  Â  Â  Â  Â  Â  externalLinksEnabled: formElements.externalLinksEnabled.checked,

Â  Â  Â  Â  Â  Â  Â  Â  discordInviteLinksEnabled: formElements.discordInviteLinksEnabled.checked,

Â  Â  Â  Â  Â  Â  Â  Â  excessiveEmojiEnabled: formElements.excessiveEmojiEnabled.checked,

Â  Â  Â  Â  Â  Â  Â  Â  excessiveEmojiCount: parseInt(formElements.excessiveEmojiCount.value, 10),

Â  Â  Â  Â  Â  Â  Â  Â  excessiveMentionsEnabled: formElements.excessiveMentionsEnabled.checked,

Â  Â  Â  Â  Â  Â  Â  Â  excessiveMentionsCount: parseInt(formElements.excessiveMentionsCount.value, 10),

Â  Â  Â  Â  Â  Â  Â  Â  excessiveCapsEnabled: formElements.excessiveCapsEnabled.checked,

Â  Â  Â  Â  Â  Â  Â  Â  excessiveCapsPercentage: parseInt(formElements.excessiveCapsPercentage.value, 10),

Â  Â  Â  Â  Â  Â  Â  Â  immuneRoles: getSelectedValues(formElements.immuneRoles), // Get selected roles

Â  Â  Â  Â  Â  Â  Â  Â  immuneChannels: getSelectedValues(formElements.immuneChannels) // Get selected channels

Â  Â  Â  Â  Â  Â  };



Â  Â  Â  Â  Â  Â  showLoading('Saving settings...');



Â  Â  Â  Â  Â  Â  try {

Â  Â  Â  Â  Â  Â  Â  Â  const response = await fetch(`/api/save-config?guildId=${selectedGuildId}`, {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  method: 'POST',

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  headers: {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'Content-Type': 'application/json',

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'Authorization': `Bearer ${discordAccessToken}`

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  body: JSON.stringify(newConfig)

Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  const data = await response.json();

Â  Â  Â  Â  Â  Â  Â  Â  if (response.ok) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showSection(dashboardView);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Provide visual feedback for success

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const successMessage = document.createElement('div');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  successMessage.className = 'absolute top-4 right-4 bg-green-500 text-white px-6 py-3 rounded-full shadow-lg transition-all duration-300';

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  successMessage.textContent = 'Settings saved successfully!';

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.body.appendChild(successMessage);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setTimeout(() => successMessage.remove(), 3000);

Â  Â  Â  Â  Â  Â  Â  Â  } else {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showErrorMessage(data.message || 'Failed to save configuration.');

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  } catch (error) {

Â  Â  Â  Â  Â  Â  Â  Â  console.error('Error saving config:', error);

Â  Â  Â  Â  Â  Â  Â  Â  showErrorMessage('An error occurred while saving the configuration.');

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  });



Â  Â  Â  Â  // Event listeners

Â  Â  Â  Â  backToServersButton.addEventListener('click', fetchGuilds);

Â  Â  Â  Â  retryButton.addEventListener('click', handleOAuthCallback);



Â  Â  Â  Â  // Check if we are on the callback URL and handle authentication

Â  Â  Â  Â  document.addEventListener('DOMContentLoaded', () => {

Â  Â  Â  Â  Â  Â  if (window.location.pathname === '/callback') {

Â  Â  Â  Â  Â  Â  Â  Â  handleOAuthCallback();

Â  Â  Â  Â  Â  Â  } else {

Â  Â  Â  Â  Â  Â  Â  Â  showSection(initialState);

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  });



Â  Â  </script>

</body>

</html>
